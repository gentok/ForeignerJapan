setwd(dirname(rstudioapi::getActiveDocumentContext()$path)); 

require(readr)
require(pbapply)

path01_1 <- character()
path01_2 <- character()
path01_3 <- character()
path01_4 <- character()
path02 <- character()
path03 <- character()
path04 <- character()
path05 <- character()
path06 <- character()
path07 <- character()
path08 <- character()
path09 <- character()
path10 <- character()
path11 <- character()
path12 <- character()
path13 <- character()
path14 <- character()
path15 <- character()
path16 <- character()
path17 <- character()
path18 <- character()
path19 <- character()
path20 <- character()

pagen <- sprintf("%02.0f",seq(1,20))

for (k in pagen) {
  tpn <- list.files(paste0("./page",k), full.names = T)
  path01_1 <- c(path01_1,tpn[grep("/001-1", tpn)])
  path01_2 <- c(path01_2,tpn[grep("/001-2", tpn)])
  path01_3 <- c(path01_3,tpn[grep("/001-3", tpn)])
  path01_4 <- c(path01_4,tpn[grep("/001-4", tpn)])
  path02 <- c(path02,tpn[grep("/002", tpn)])
  path03 <- c(path03,tpn[grep("/003", tpn)])
  path04 <- c(path04,tpn[grep("/004", tpn)])
  path05 <- c(path05,tpn[grep("/005", tpn)])
  path06 <- c(path06,tpn[grep("/006", tpn)])
  path07 <- c(path07,tpn[grep("/007", tpn)])
  path08 <- c(path08,tpn[grep("/008", tpn)])
  path09 <- c(path09,tpn[grep("/009", tpn)])
  path10 <- c(path10,tpn[grep("/010", tpn)])
  path11 <- c(path11,tpn[grep("/011", tpn)])
  path12 <- c(path12,tpn[grep("/012", tpn)])
  path13 <- c(path13,tpn[grep("/013", tpn)])
  path14 <- c(path14,tpn[grep("/014", tpn)])
  path15 <- c(path15,tpn[grep("/015", tpn)])
  path16 <- c(path16,tpn[grep("/016", tpn)])
  path17 <- c(path17,tpn[grep("/017", tpn)])
  path18 <- c(path18,tpn[grep("/018", tpn)])
  path19 <- c(path19,tpn[grep("/019", tpn)])
  path20 <- c(path20,tpn[grep("/020", tpn)])
  rm(tpn)
}

d01 <- rbind(
  do.call("rbind", pblapply(path01_1, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1])),
  do.call("rbind", pblapply(path01_2, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1])),
  do.call("rbind", pblapply(path01_3, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1])),
  do.call("rbind", pblapply(path01_4, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
)
summary(d01)
saveRDS(d01, "./table01.rds")
rm(d01)

d02 <- do.call("rbind", pblapply(path02, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
summary(d02)
saveRDS(d02, "./table02.rds")
rm(d02)

d03 <- do.call("rbind", pblapply(path03, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d03) <- gsub("_1","_男",colnames(d03))
colnames(d03) <- gsub("_2","_女",colnames(d03))
summary(d03)
saveRDS(d03, "./table03.rds")
rm(d03)

d04 <- do.call("rbind", pblapply(path04, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d04) <- gsub("_1","_男",colnames(d04))
colnames(d04) <- gsub("_2","_女",colnames(d04))
summary(d04)
saveRDS(d04, "./table04.rds")
rm(d04)

d05 <- do.call("rbind", pblapply(path05, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
summary(d05)
saveRDS(d05, "./table05.rds")
rm(d05)

tmp <- as.character(read_csv(path06[1], skip=4, col_names = F, n_max=1,locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1])
tmp <- unique(tmp)[-1]
tmp

d06 <- do.call("rbind", pblapply(path06, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d06) <- gsub("1\\)$",paste0("1)_",tmp[1]),colnames(d06))
colnames(d06) <- gsub("世帯$",paste0("世帯_",tmp[1]),colnames(d06))
colnames(d06) <- gsub("_1",paste0("_",tmp[2]),colnames(d06))
colnames(d06) <- gsub("_2",paste0("_",tmp[3]),colnames(d06))
colnames(d06) <- gsub("_3",paste0("_",tmp[4]),colnames(d06))
colnames(d06) <- gsub("_4",paste0("_",tmp[5]),colnames(d06))
colnames(d06) <- gsub("_5",paste0("_",tmp[6]),colnames(d06))
colnames(d06) <- gsub("_6",paste0("_",tmp[7]),colnames(d06))
summary(d06)
saveRDS(d06, "./table06.rds")
rm(d06)

d07 <- do.call("rbind", pblapply(path07, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d07) <- gsub("_1","_男",colnames(d07))
colnames(d07) <- gsub("_2","_女",colnames(d07))
summary(d07)
saveRDS(d07, "./table07.rds")
rm(d07)

d08 <- do.call("rbind", pblapply(path08, function(k) read_csv(k, skip=7, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d08) <- gsub("_1","_男",colnames(d08))
colnames(d08) <- gsub("_2","_女",colnames(d08))
summary(d08)
saveRDS(d08, "./table08.rds")
rm(d08)

d09 <- do.call("rbind", pblapply(path09, function(k) read_csv(k, skip=7, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d09) <- gsub("_1","_男",colnames(d09))
colnames(d09) <- gsub("_2","_女",colnames(d09))
summary(d09)
saveRDS(d09, "./table09.rds")
rm(d09)

d10 <- do.call("rbind", pblapply(path10, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d10) <- gsub("_1","_男",colnames(d10))
colnames(d10) <- gsub("_2","_女",colnames(d10))
summary(d10)
saveRDS(d10, "./table10.rds")
rm(d10)

d11 <- do.call("rbind", pblapply(path11, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d11) <- gsub("_1","_男",colnames(d11))
colnames(d11) <- gsub("_2","_女",colnames(d11))
summary(d11)
saveRDS(d11, "./table11.rds")
rm(d11)

d12 <- do.call("rbind", pblapply(path12, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d12) <- gsub("_1","_男",colnames(d12))
colnames(d12) <- gsub("_2","_女",colnames(d12))
summary(d12)
saveRDS(d12, "./table12.rds")
rm(d12)

d13 <- do.call("rbind", pblapply(path13, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d13) <- gsub("_1","_男",colnames(d13))
colnames(d13) <- gsub("_2","_女",colnames(d13))
summary(d13)
saveRDS(d13, "./table13.rds")
rm(d13)

d14 <- do.call("rbind", pblapply(path14, function(k) read_csv(k, skip=8, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d14) <- gsub("_1","_男",colnames(d14))
colnames(d14) <- gsub("_2","_女",colnames(d14))
summary(d14)
saveRDS(d14, "./table14.rds")
rm(d14)

d15 <- do.call("rbind", pblapply(path15, function(k) read_csv(k, skip=7, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d15) <- gsub("_1","_男",colnames(d15))
colnames(d15) <- gsub("_2","_女",colnames(d15))
summary(d15)
saveRDS(d15, "./table15.rds")
rm(d15)

d16 <- do.call("rbind", pblapply(path16, function(k) read_csv(k, skip=3, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
summary(d16)
saveRDS(d16, "./table16.rds")
rm(d16)

d17 <- do.call("rbind", pblapply(path17, function(k) read_csv(k, skip=5, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d17) <- gsub("_1","_男",colnames(d17))
colnames(d17) <- gsub("_2","_女",colnames(d17))
summary(d17)
saveRDS(d17, "./table17.rds")
rm(d17)

d18 <- do.call("rbind", pblapply(path18, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d18) <- gsub("不詳$","就業不詳",colnames(d18))
colnames(d18) <- gsub("不詳_1","通学不詳",colnames(d18))
colnames(d18) <- gsub("不詳_2","就業不詳_1",colnames(d18))
colnames(d18) <- gsub("不詳_3","通学不詳_1",colnames(d18))
colnames(d18) <- gsub("不詳_4","就業不詳_2",colnames(d18))
colnames(d18) <- gsub("不詳_5","通学不詳_2",colnames(d18))
colnames(d18) <- gsub("_1","_男",colnames(d18))
colnames(d18) <- gsub("_2","_女",colnames(d18))
summary(d18)
saveRDS(d18, "./table18.rds")
rm(d18)

d19 <- do.call("rbind", pblapply(path19, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d19) <- gsub("_1","_就業",colnames(d19))
colnames(d19) <- gsub("_2","_通学",colnames(d19))
colnames(d19) <- gsub("_3","_男",colnames(d19))
colnames(d19) <- gsub("_4","_就業_男",colnames(d19))
colnames(d19) <- gsub("_5","_通学_男",colnames(d19))
colnames(d19) <- gsub("_6","_女",colnames(d19))
colnames(d19) <- gsub("_7","_就業_女",colnames(d19))
colnames(d19) <- gsub("_8","_通学_女",colnames(d19))
colnames(d19) <- gsub("総数（利用交通手段）　1\\)_就業","総数（利用交通手段）　1)_男",colnames(d19))
colnames(d19) <- gsub("総数（利用交通手段）　1\\)_通学","総数（利用交通手段）　1)_女",colnames(d19))
colnames(d19) <- gsub("自宅外就業者数　1\\)_就業","自宅外就業者数　1)_男",colnames(d19))
colnames(d19) <- gsub("自宅外就業者数　1\\)_通学","自宅外就業者数　1)_女",colnames(d19))
colnames(d19) <- gsub("通学者数　1\\)_就業","通学者数　1)_男",colnames(d19))
colnames(d19) <- gsub("通学者数　1\\)_通学","通学者数　1)_女",colnames(d19))
summary(d19)
saveRDS(d19, "./table19.rds")
rm(d19)

d20 <- do.call("rbind", pblapply(path20, function(k) read_csv(k, skip=6, locale = locale(encoding="CP932"), na=c("-","X","","NA"))[,-1]))
colnames(d20) <- gsub("_1","_男",colnames(d20))
colnames(d20) <- gsub("_2","_女",colnames(d20))
summary(d20)
saveRDS(d20, "./table20.rds")
rm(d20)

# setwd("/home/gentok/GoogleDrive/Projects/Fan-Gento-Lab/ForeignerJapan")
# adddt <- readRDS("./data/original/sifcct_address/adddt_all.rds")
# adddt[[2]]$Feature
